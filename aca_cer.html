<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Academic Certificate Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body{font-family:Roboto,Arial,sans-serif;background:#eef2f7;padding:20px;color:#222}
.container{max-width:1300px;margin:auto;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.12);overflow:hidden;padding:20px}
header{background:#0f3b63;color:#fff;padding:20px;text-align:center;border-radius:10px}
header h1{margin:0;font-size:24px;font-family:'Playfair Display',serif}
.content{display:flex;flex-direction:column;gap:20px;margin-top:20px}
.top-form{display:flex;flex-wrap:wrap;gap:20px;justify-content:center}
.card{background:#fafcff;padding:15px;border:1px solid #dde5ee;border-radius:10px;min-width:300px;flex:1}
.card label{display:block;margin:8px 0 4px;font-weight:500;color:#0f3b63}
.card input{width:100%;padding:8px;border:1px solid #c8d4e2;border-radius:6px}
.bottom-preview{text-align:center;margin-top:20px}
#print-btn{margin-bottom:20px;}
#certificatesContainer{display:flex;flex-direction:column;align-items:center;gap:30px}

/* Certificate */
.certificate{width:297mm;height:210mm;background:#fff;border:1px solid #bbb;padding:20mm;box-shadow:0 5px 15px rgba(0,0,0,0.1);position:relative;page-break-after:always}
.student-photo{width:100px;height:120px;object-fit:cover;border:1px solid #ccc;position:absolute;top:5px;right:40px}
.school-logo{width:90px;height:90px;object-fit:contain;position:absolute;top:5px;left:60px}

.school-title{text-align:center;font-size:28px;font-family:'Playfair Display',serif;color:#b02a2a;margin-bottom:6px}
.school-sub{text-align:center;font-size:13px;color:#333}
.cert-heading{text-align:center;font-size:22px;font-family:'Playfair Display',serif;color:#0f3b63;margin:20px 0}
.cert-body{font-size:15px;color:#222;line-height:1.6;margin-top:20px;text-align:justify}
.signature-row{display:flex;justify-content:space-between;margin-top:40px;align-items:flex-end}
.signature{text-align:center;font-weight:600;color:#0f3b63;width:30%}
.signature img{max-height:60px;display:block;margin:auto;margin-bottom:5px}
.date-issue{margin-top:25px;font-size:13px;color:#0f3b63}

/* Table */
.student-info-table{width:100%;border-collapse:collapse;margin-top:20px;font-size:14px;text-align:center}
.student-info-table th,.student-info-table td{border:1px solid #333;padding:6px}

@media print {
  body {background:#fff;}
  .container, .top-form, .card, header, .bottom-preview > button {display:none !important;}
  #certificatesContainer{display:block;}
  .certificate{box-shadow:none;border:1px solid #000;margin:0 auto;}
  @page { size:A4 landscape; margin:10mm; }
}

.print-btn{
  background:#0f3b63;color:#fff;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-weight:600;margin-bottom:15px
}
.print-btn:hover{background:#124a7a}
</style>
</head>
<body>




<div class="container">
<header><h1>Certificate Generator</h1></header>
<div class="content">
<div class="top-form">

<!-- School Info -->
<div class="card">
<label>School Name</label><input id="schoolName" placeholder="School Name">
<label>Regd No.</label><input id="schoolReg" placeholder="Regd No.">
<label>Address</label><input id="schoolAddr" placeholder="Address">
<label>ESTD</label><input id="schoolEstd" placeholder="ESTD">
<label>Date of Issue</label><input id="dateIssue" placeholder="e.g. 2080/05/19">
</div>

<!-- Upload Logos/Signs/Seal -->
<div class="card">
<label>Upload School Logo</label><input type="file" id="logoInput" accept="image/*">
<label>Upload Principal Sign</label><input type="file" id="principalSignInput" accept="image/*">
<label>Upload Approved By Sign</label><input type="file" id="approveSignInput" accept="image/*">
<label>Upload School Seal</label><input type="file" id="sealInput" accept="image/*">
</div>

<!-- Excel & Photo Folder -->
<div class="card">
<label>Upload Excel</label><input type="file" id="fileInput" accept=".xlsx,.xls,.csv">
<p style="font-size:12px;color:#666">Excel ‡§Æ‡§æ 'Photo' column ‡§∞‡§æ‡§ñ‡•á‡§™‡§õ‡§ø ‡§§‡•ç‡§Ø‡§π‡§æ‡§Å filename ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§≤‡•á‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç (‡§ú‡§∏‡•ç‡§§‡•à: Brp ‡§µ‡§æ Brp.jpg) ‡§∞ ‡§â‡§π‡•Ä folder ‡§Æ‡§æ photo ‡§∞‡§æ‡§ñ‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç‡•§</p>
<label>Upload Student Photo Folder</label><input type="file" id="photoFolder" webkitdirectory directory multiple>
</div>
</div>

<div class="bottom-preview">
<button class="print-btn" onclick="window.print()">üñ® Print Certificates</button>
<div id="certificatesContainer"></div>
</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
const fileInput=document.getElementById('fileInput');
const certContainer=document.getElementById('certificatesContainer');
const inputs=['schoolName','schoolReg','schoolAddr','schoolEstd','dateIssue'];
const logoInput=document.getElementById('logoInput');
const principalSignInput=document.getElementById('principalSignInput');
const approveSignInput=document.getElementById('approveSignInput');
const sealInput=document.getElementById('sealInput');
const photoFolderInput=document.getElementById('photoFolder');

let students=JSON.parse(localStorage.getItem('students')||'[]');
let uploadedPhotos=[];
let schoolLogo=localStorage.getItem('schoolLogo')||'';
let principalSign=localStorage.getItem('principalSign')||'';
let approveSign=localStorage.getItem('approveSign')||'';
let schoolSeal=localStorage.getItem('schoolSeal')||'';

// Restore inputs
inputs.forEach(id=>{
  const el=document.getElementById(id);
  el.value=localStorage.getItem(id)||'';
  el.addEventListener('input',()=>{localStorage.setItem(id,el.value);renderAll();});
});

// Convert to Base64
function toBase64(file,cb){const reader=new FileReader();reader.onload=()=>cb(reader.result);reader.readAsDataURL(file);}
logoInput.addEventListener('change',e=>{const f=e.target.files[0];if(f) toBase64(f,res=>{schoolLogo=res;localStorage.setItem('schoolLogo',res);renderAll();});});
principalSignInput.addEventListener('change',e=>{const f=e.target.files[0];if(f) toBase64(f,res=>{principalSign=res;localStorage.setItem('principalSign',res);renderAll();});});
approveSignInput.addEventListener('change',e=>{const f=e.target.files[0];if(f) toBase64(f,res=>{approveSign=res;localStorage.setItem('approveSign',res);renderAll();});});
sealInput.addEventListener('change',e=>{const f=e.target.files[0];if(f) toBase64(f,res=>{schoolSeal=res;localStorage.setItem('schoolSeal',res);renderAll();});});

// Excel Upload
fileInput.addEventListener('change',e=>{
  const f=e.target.files[0];if(!f)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    const wb=XLSX.read(new Uint8Array(ev.target.result),{type:'array'});
    const ws=wb.Sheets[wb.SheetNames[0]];
    students=XLSX.utils.sheet_to_json(ws,{defval:''});
    localStorage.setItem('students',JSON.stringify(students));
    renderAll();
  };
  reader.readAsArrayBuffer(f);
});

// Photo folder
photoFolderInput.addEventListener('change',e=>{uploadedPhotos=[...e.target.files];renderAll();});

// Render
function renderAll(){
certContainer.innerHTML='';
students.forEach(s=>{
  const photoFile=s['Photo']?s['Photo'].trim():'';
  let photoUrl='';
  if(photoFile && uploadedPhotos.length){
    let match=uploadedPhotos.find(p=>p.name.toLowerCase()===photoFile.toLowerCase()||
      p.name.toLowerCase()===(photoFile+'.jpg').toLowerCase()||
      p.name.toLowerCase()===(photoFile+'.jpeg').toLowerCase()||
      p.name.toLowerCase()===(photoFile+'.png').toLowerCase()
    );
    if(match) photoUrl=URL.createObjectURL(match);
  }

  const div=document.createElement('div');
  div.className='certificate';
  div.innerHTML=`
    ${schoolLogo?`<img src="${schoolLogo}" class="school-logo">`:''}
    ${photoUrl?`<img src="${photoUrl}" class="student-photo">`:''}
    <div class="school-title">${document.getElementById('schoolName').value||'SCHOOL NAME'}</div>
    <div class="school-sub">${document.getElementById('schoolAddr').value||'-'} | ESTD: ${document.getElementById('schoolEstd').value||'-'} | Regd No. ${document.getElementById('schoolReg').value||'-'}</div>
    <div class="cert-heading">Transfer/Character Certificate</div>
    <div class="cert-body">
      Certified that <strong style="color:#b02a2a">${s['Name']||'-'}</strong> son/daughter of <strong style="color:#b02a2a">${s['Father Name']||'-'} & ${s['Mother Name']||'-'}</strong>, inhabitant of <strong style="color:#b02a2a">${s['Address']||'-'}</strong>, was a bona fide student of this school. He/She has duly completed <strong style="color:#b02a2a">${s['Program']||'-'}</strong> Conducted by the National Examination Board Nepal with GPA <strong style="color:#b02a2a">${s['GPA']||'-'}</strong> in the year <strong style="color:#b02a2a">${s['Completion Year']||'-'} BS</strong>. He/She bore a good moral character while at this school. His/Her Date of Birth according to the school record is <strong style="color:#b02a2a">${s['DOB']||'-'}</strong>.

      <br><br>
      I wish him/her every success and bright future in the days to come.
    </div>

    <!-- Student Info Table -->
    <table class="student-info-table">
      <tr><th>Opt. I</th><th>Opt. II</th><th>Symbol No</th><th>Reg. No</th></tr>
      <tr>
        <td>${s['Opt. I']||'-'}</td>
        <td>${s['Opt. II']||'-'}</td>
        <td>${s['Symbol No']||'-'}</td>
        <td>${s['Reg. No']||'-'}</td>
      </tr>
    </table>

    <div class="signature-row">
      <div class="signature">${approveSign?`<img src="${approveSign}">`:''} Approved by</div>
      <div class="signature">${schoolSeal?`<img src="${schoolSeal}">`:''} School Seal</div>
      <div class="signature">${principalSign?`<img src="${principalSign}">`:''} Principal</div>
    </div>
    <div class="date-issue">Date of Issue: ${document.getElementById('dateIssue').value||'-'}</div>
  `;
  certContainer.appendChild(div);
});
}
renderAll();
</script>
</body>
</html>
